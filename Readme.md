# Code of conduct

[[_TOC_]]

### Условные обозначения
- [Gitlab issues](https://gitlab.com/temikmax/org-mephi-2.0/-/issues): `Issues`, `Issue`
- [Merge Request](https://gitlab.com/temikmax/org-mephi-2.0/-/merge_requests): `MR`
- Code Review: `CR`
- Основная ветка: `master`

### Правила работы с Git

1. **Основа - [GitLab Flow](https://docs.gitlab.com/ee/topics/gitlab_flow.html#production-branch-with-gitlab-flow)**
1. `Issue` ставятся в `Issues`
1. Фиксированные ветки:
    - `master`
1. Пушить напрямую в `master` запрещено
1. Все изменения в `master` можно добавить только через `MR` из веток разработки

### Правила взаисодействия со статусом задач
1. `Issue` в статусе `status: stuck`, если что-то блокирует азадчу: design, API или нереализованный backend. Это должно быть отображено в соответвующих labels
1. `Issue` в статусе `status: open`, если она готова к реализации и разрешены все блокирующие элементы: design, API, или backend
1. `Issue` в статусе `status: in progress`, если она в процессе реализации. Реализация `Issue` включает в себя:
    - Написание кода
    - Написание тестов
    - Проходение тестов в системе CI
1. `Issue` в статусе `status: on review`, если она реализована и требуется `CR`
1. `Issue` в статусе `status: done`, если она реализована, одобрено `CR` и код добавлен в соотствующую ветку разработки. В том числе:
    - Пройдено `CR`
    - Добавляемый функционал отвечает требованиям ТЗ и/или API
    - Соблюдены требования дизайна
    - Закрыт `MR` и изменения добавлены в ветку `master`
1. `Issue` считается закрытой, если код из соответствующей ветки разработки добавлен в ветку `master`. А также:

### Правила со взаисодействия со статусом MR
1. `MR` не может иметь label `status`
1. Если `Issue`, соотвествующий `MR` находится в статусе `status: in progress`, то имя `MR` должно следовать шаблону `Draft: Resolve "Имя_задачи"`
1. Если `Issue`, соотвествующий `MR` находится в статусе `status: in review`, то имя `MR` должно следовать шаблону `Resolve "Имя_задачи"`
1. Если `Issue`, соотвествующий `MR` находится в статусе `status: done`, то имя `MR` должно следовать шаблону `Resolve "Имя_задачи"`, а `MR` сам должен быть в состоянии `merged`
1. При согласовании `MR` следует руководствоваться [Инженерными практиками Google для Code Review](https://tproger.ru/translations/code-review-a-la-google/)

### Правила именования коммитов
#### Общий стиль
> `тип коммита`: `для какой сущности` `подробности`

Примеры:
> `add: mass email send method to MailSenderService`

> `fix: flaky exception in MailSenderService`

> `test: fix failed unit tests`

#### Язык
Английский. Простое настоящее время (Present Simple).

#### Типы коммитов
- `add` - добавление новой функциональности
- `fix` - исправление бага
- `style` - исправление опечаток и форматирования
- `refactor` - рефакторинг кода
- `ci` - всё, что связано с конфигурацией CI/CD/k8s
- `docs` - всё, что касается документации
- `test` - всё, что связано с тестированием
- `chore` - обычное обслуживание кода




# Frontend code of conduct

### Инструменты разработки
- [JetBrains WebStorm 2021.1](https://www.jetbrains.com/webstorm/)
    - Code style находится в файле `.idea/codeStyles/Project.xml`
- [Node.js 14 LTS](https://nodejs.org/en/)
- [yarn 1.22.5](https://classic.yarnpkg.com/en/docs/install/)

### Скрипты для сборки
- `yarn --cwd frontend install` - устанавливает зависимости Node.js в папку `frontend/node_modules`
- `yarn --cwd frontend debug` - запускает версию для отладки в конфигурации *hot module replacement* по адресу `http://127.0.0.1:4200`
    - Необходимо установить зависимости Node.js 
- `yarn --cwd frontend build` - собирает production версию в папку `frontend/dist`
    - Необходимо установить зависимости Node.js
- `yarn --cwd frontend production` - запускает production версию из папку `frontend/dist` по адресу `http://127.0.0.1:3000`
    - Необходимо установить зависимости Node.js и собрать production версию



# Backend code of conduct

### Состав системы
```
/user/...                   - сервис управления пользователями
    /registration/...       - модуль регастрации (без авторизации)
    /auth/...               - модуль аутентификации (уровень доступа варьируется)
    /profile/...            - модуль управления профилем пользователя (уровень доступа - участник)
    /creator/...            - модуль организатора - просмотр пользователей (уровень доступа - организатор)
    /admin/...              - модуль администратора - редактирование пользователей (уровень доступа - администратор)

/contest/...                - сервис управления конкурсами и олимпиадами
    /tasks/...              - подсистема управления карточками конкурса и этапа
        /unauthorized/...   - неавторизованная часть подсистемы - просмотр доступных олимпиад (без авторизации)
        /participant/...    - модуль участника - запись на олимпиады (уровень доступа - участник)
        /creator/...        - модуль организтора - создание и редактирование карточек конкурса и этапа (уровень доступа - организатор)
        /control_users/...  - модуль управления участниками конкурсов и этапов (уровень доступа - организатор)
        /admin/...          - модуль администратора - управление метаинформацией олимпиад (уровень доступа - администратор)
    /responses/...          - подсистема управления загруженными работами
        /participant/...    - модуль участника - загрузка работ и просмотр результатов (уровень доступа - участник)
        /creator/...        - модуль организатора - проверка и оценка работ (уровень доступа - организатор)

/analytics/...              - сервис предоставления аналитики (TBD)

/aggregate                  - вспомогательный сервис для запуска всех сервисов в рамках одного процесса
```


### Скрипты для сборки

Для указания исполняемого файла системы необходимо указать значение переменной среды `FLASK_APP`, например:
```
export FLASK_APP=./aggregate/app.py
```
Путь к исполняемому файлу задается следующим образом: `путь_к_backend_директории/название_сервиса/app.py`

Возможно также указание режима запуска при помощи переменной среды `FLASK_ENV`, например:
```
export FLASK_ENV="development"
```
Возможные значения переменной FLASK_ENV:
- development
- production

Запуск системы выполнятся при помощи следующей команды: 
```
python -m flask run [--port номер_порта]
```

Для запуска с использованием https необходимо указать опции `--cert=<путь_к_сертификату>` и `--key=<путь_к_ключу>`, например:
```
python -m flask run [--port номер_порта] --cert=cert.pem --key=key.pem
```

Возможен запуск системы при помощи вспомогательных скриптов:
- `run_microservice.sh [analytics port] [contest port] [user port]` - запуск всех микросервисов отдельно
- `run_monolith.sh [port]` - запуск всех микросервисов в рамках одного процесса

### Конфигурация системы

Конфигурация системы осуществляется при помощи указания файла конфигурации в переменной среды `ORGMEPHI_<НАЗВАНИЕ_СЕРВИСА>_CONFIG`, например:
```
export ORGMEPHI_AGGREGATE_CONFIG=./config.py
```

Конфигурации системы необходимо вносить в указанный файл. Полный перечень доступных опций приведен в [/backend/aggregate/default_config.py](/backend/aggregate/default_config.py)

### Работа с API

Графический интерфейс для работы с swagger/openapi описанием интерфейса системы доступен на странице `/название_компонента/swagger_ui`, например `/user/swagger_ui` или `/user/profile/swagger_ui`. `/swagger_ui` - интерфейс всей системы. Графический интерфейс доступен только в режиме запуска `development`.

API системы в текстовом виде доступно на странице `/название_компонента/swagger_ui/api.yaml`.