# Backend системы "ОРГ МИФИ 2.0 Олимпиады"
### Состав системы

```
/user/...                   - сервис управления пользователями
    /registration/...       - модуль регастрации (без авторизации)
    /auth/...               - модуль аутентификации (уровень доступа варьируется)
    /profile/...            - модуль управления профилем пользователя (уровень доступа - участник)
    /creator/...            - модуль организатора - просмотр пользователей (уровень доступа - организатор)
    /admin/...              - модуль администратора - редактирование пользователей (уровень доступа - администратор)


/contest/...                - сервис управления конкурсами и олимпиадами
    /tasks/...              - подсистема управления карточками конкурса и этапа
        /unauthorized/...   - неавторизованная часть подсистемы - просмотр доступных олимпиад (без авторизации)
        /participant/...    - модуль участника - запись на олимпиады (уровень доступа - участник)
        /creator/...        - модуль организтора - создание и редактирование карточек конкурса и этапа (уровень доступа - организатор)
        /control_users/...  - модуль управления участниками конкурсов и этапов (уровень доступа - организатор)
        /admin/...          - модуль администратора - управление метаинформацией олимпиад (уровень доступа - администратор)
    /responses/...          - подсистема управления загруженными работами
        /participant/...    - модуль участника - загрузка работ и просмотр результатов (уровень доступа - участник)
        /creator/...        - модуль организатора - проверка и оценка работ (уровень доступа - организатор)


/analytics/...              - сервис предоставления аналитики (TBD)


/aggregate                  - вспомогательный сервис для запуска всех сервисов в рамках одного процесса
```


### Запуск системы

Для указания исполняемого файла системы необходимо указать значение переменной среды `FLASK_APP`, например:
```
export FLASK_APP=./aggregate/app.py
```
Путь к исполняемому файлу задается следующим образом: `путь_к_backend_директории/название_сервиса/app.py`

Возможно также указание режима запуска при помощи переменной среды `FLASK_ENV`, например:
```
export FLASK_ENV="development"
```
Возможные значения переменной FLASK_ENV:
- development
- production

Запуск системы выполнятся при помощи следующей команды: 
```
python -m flask run [--port номер_порта]
```

Возможен запуск системы при помощи вспомогательных скриптов:
- `run_microservice.sh [analytics port] [contest port] [user port]` - запуск всех микросервисов отдельно
- `run_monolith.sh [port]` - запуск всех микросервисов в рамках одного процесса

### Конфигурация системы

Конфигурация системы осуществляется при помощи указания файла конфигурации в переменной среды `ORGMEPHI_<НАЗВАНИЕ_СЕРВИСА>_CONFIG`, например:
```
export ORGMEPHI_AGGREGATE_CONFIG=./config.py
```

Конфигурации системы необходимо вносить в указанный файл. Полный перечень доступных опций приведен в [/backend/aggregate/default_config.py](/backend/aggregate/default_config.py)

### Работа с API

Графический интерфейс для работы с swagger/openapi описанием интерфейса системы доступен на странице `/название_компонента/swagger_ui`, например `/user/swagger_ui` или `/user/profile/swagger_ui`. `/swagger_ui` - интерфейс всей системы. Графический интерфейс доступен только в режиме запуска `development`.

API системы в текстовом виде доступно на странице `/название_компонента/swagger_ui/api.yaml`.
